"use strict";d3.tsv("./data/typemetrics.tsv",function(t,e){function i(t,e,i){return d3.layout.histogram().bins(t).value(function(t){return t[e]})(i)}function n(t){g=d3.scale.linear().domain(d3.extent(e,function(e){return parseFloat(e[t],10)})).nice().range([v,x-v])}function a(t,e,i){t.scale(e),b.select("#"+i).transition().duration(1500).call(t)}function r(t){return d3.max(t,function(t){return t.y})}function l(t,e){var i=[t,e];return d3.max(i,function(t){return t})}function s(t){m=d3.scale.linear().domain([0,t+5]).nice().range([S-v,v])}function o(t,e,i){var n=b.select("#"+t+"Circles");b.selectAll("."+t+"circleSubgroup").remove(),n.append("g").attr("id",t+"FilledCircles").selectAll("circle").data(e).enter().append("g").each(function(t){t.forEach(function(e){e.x=t.x})}).selectAll("circle").data(function(t){return t}).enter().append("circle").attr({"class":t+"circleSubgroup",cx:function(t){return g(t.x)},cy:function(t,e){return m(e+1)},r:2,fill:i,opacity:.25}),n.append("g").attr("id",t+"PointCircles").selectAll("circle").data(e).enter().append("circle").attr({"class":t+"circleSubgroup",cx:function(t){return g(t.x)},cy:function(t){return m(t.y)},r:2,stroke:i,fill:"white"}),n.selectAll("text").data(e).enter().append("text").text(function(t){return t.y>=1?t.y:null}).attr({"class":t+"circleSubgroup","text-anchor":"middle","font-size":"10px",fill:i,x:function(t){return g(t.x)},y:function(t){return m(t.y)-7.5}})}function c(t,e){t.transition().duration(750).attr("d",A(e))}function d(t){var e=d3.scale.ordinal().domain(["select","xHeight","CapHeight","Weight","Contrast","Lesser Thickness Slope","Superior Overshooting","Inferior Overshooting","Ascenders","Descenders","n Expansion","o Expansion","n/o Ratio","O Expansion","R Expansion","R/O Ratio","o Average Squaring","o Internal Squaring","o External Squaring"]).range(["select.png","xHeight.png","capHeight.png","Weight.png","Contrast.png","LesThiSlo.png","OvershootingSup.png","OvershootingInf.png","Ascenders.png","Descenders.png","nExp.png","oExp.png","noRat.png","OCapsExp.png","RExp.png","RORat.png","oAvgSqu.png","oIntSqu.png","oExtSqu.png"]);return'<img src="./img/typemetrics/'+e(t)+'">'}var p,u,g,m,h=d3.keys(e[0]).filter(function(t){return"FamilyName"!==t&&"Spacing"!==t&&"StyleName"!==t&&"Grazie"!==t&&"Bezier"!==t&&"SimmetriaAggettiT"!==t&&"AltezzaMassimaH"!==t&&"PuntoMedioAstaOrizzontaleH"!==t&&"PuntoMedioAstaVerticaleT"!==t&&"AggettoSinistroT"!==t&&"AggettoDestroT"!==t&&"SimmetriaAggettiT"!==t}),f=e.filter(function(t){return"Sans"===t.Grazie}),y=e.filter(function(t){return"Serif"===t.Grazie}),x=1e3,S=500,v=50,b=d3.select("#svg-histogram-container").append("svg").attr("viewBox","0 0 "+x+" "+S).attr("preserveAspectRatio","xMaxYMin").attr("meetOrSlice","meet"),A=(b.append("clipPath").attr("id","histogram-area").append("rect").attr("x",v).attr("y",v).attr("width",x-2*v).attr("height",S-2*v),d3.select("#svg-histogram-legend"),d3.svg.line().interpolate("monotone").x(function(t){return g(t.x)}).y(function(t){return m(t.y)}));p=25,u="xHeight",d3.select("#xAxisHistogram ul").selectAll("li").data(h).enter().append("li").style({cursor:"pointer",role:"menuitem",tabindex:-1}).text(function(t){return t}),i(p,u,f),i(p,u,y),n(u),s(l(r(i(p,u,f)),r(i(p,u,y))));var k=b.append("path").attr("clip-path","url(#histogram-area)").attr("class","sansElements").attr("id","SansPath").style({fill:"none",stroke:"#32CD32","stroke-width":"1px",visibility:"visible"}),C=b.append("path").attr("clip-path","url(#histogram-area)").attr("class","serifElements").attr("id","SerifPath").style({fill:"none",stroke:"#DC143C","stroke-width":"1px",visibility:"visible"});b.append("g").attr("id","sansCircles").attr("class","sansElements").attr("clip-path","url(#histogram-area)"),b.append("g").attr("id","serifCircles").attr("class","serifElements").attr("clip-path","url(#histogram-area)"),o("sans",i(p,u,f),"#32CD32"),c(k,i(p,u,f)),o("serif",i(p,u,y),"#DC143C"),c(C,i(p,u,y));var N=d3.svg.axis().scale(g).orient("bottom").ticks(20);b.append("g").attr("id","xaxis").attr("class","x axis").attr("transform","translate(0,"+(S-v)+")").call(N);var D=d3.svg.axis().scale(m).tickSize(900).orient("left"),w=b.append("g").attr("id","yaxis").attr("class","y axis").attr("transform","translate("+(x-v)+", 0)").call(D);w.selectAll("g").filter(function(t){return t}).classed("minor",!0),d3.select("#xAxisHistogram a").attr("data-content",d("select")),$("#xAxisHistogram").on("click",".dropdown-menu li",function(){u=$(this).text(),$("#xAxisHistogramDropdown").html(u+' <i class="fa fa-caret-down"></i>'),$("#xAxisHistogramDropdown").val(u);var t=$("#xAxisHistogramDropdown").val();d3.select("#xAxisHistogram a").attr("data-content",d(t)),i(p,u,f),i(p,u,y),n(u),s(l(r(i(p,u,f)),r(i(p,u,y)))),a(N,g,"xaxis"),a(D,m,"yaxis"),o("sans",i(p,u,f),"#32CD32"),c(k,i(p,u,f)),o("serif",i(p,u,y),"#DC143C"),c(C,i(p,u,y))}),d3.select("#histogramSlider").on("change",function(){p=+$(this).val(),i(p,u,f),i(p,u,y),s(l(r(i(p,u,f)),r(i(p,u,y)))),a(D,m,"yaxis"),o("sans",i(p,u,f),"#32CD32"),c(k,i(p,u,f)),o("serif",i(p,u,y),"#DC143C"),c(C,i(p,u,y))}),$("#SansLineCheckbox").on("change",function(){this.checked===!0?b.selectAll(".sansElements").style("visibility","visible"):b.selectAll(".sansElements").style("visibility","hidden")}),$("#SerifLineCheckbox").on("click",function(){this.checked===!0?b.selectAll(".serifElements").style("visibility","visible"):b.selectAll(".serifElements").style("visibility","hidden")})}),d3.tsv("./data/typemetrics.tsv",function(t,e){function i(t,e,i,n,a){function r(t,e,i){return o.domain([t[0],e[0]]).range([t[1],e[1]]),[i,o(i)]}var l=i.map(function(i){return[+i[t],+i[e]]}),s=regression("linear",l).points.sort(function(t,e){return d3.ascending(t[0],e[0])}),o=d3.scale.linear(),c=0,d=parseInt(s.length,10)-1;F=r(s[c],s[d],d3.min(C.domain())),E=r(s[c],s[d],d3.max(C.domain())),n.transition().duration(a).attr("x1",function(){return C(F[0])}).attr("y1",function(){return N(F[1])}).attr("x2",function(){return C(E[0])}).attr("y2",function(){return N(E[1])}).attr("clip-path","url(#scatterplot-area)").style({opacity:.5,"stroke-width":1,"stroke-dasharray":"3, 3"})}function n(t){var e=d3.scale.ordinal().domain(["select","xHeight","CapHeight","Weight","Contrast","Lesser Thickness Slope","Superior Overshooting","Inferior Overshooting","Ascenders","Descenders","n Expansion","o Expansion","n/o Ratio","O Expansion","R Expansion","R/O Ratio","o Average Squaring","o Internal Squaring","o External Squaring"]).range(["select.png","xHeight.png","capHeight.png","Weight.png","Contrast.png","LesThiSlo.png","OvershootingSup.png","OvershootingInf.png","Ascenders.png","Descenders.png","nExp.png","oExp.png","noRat.png","OCapsExp.png","RExp.png","RORat.png","oAvgSqu.png","oIntSqu.png","oExtSqu.png"]);return'<img src="./img/typemetrics/'+e(t)+'">'}function a(t){C=d3.scale.linear().domain(d3.extent(e,function(e){return parseFloat(e[t],10)})).nice().range([M,O-M])}function r(t){N=d3.scale.linear().domain(d3.extent(e,function(e){return parseFloat(e[t])})).nice().range([T-M,M])}function l(){A=d3.scale.linear().domain(d3.extent(e,function(t){return parseFloat(t[B])})).range(["#D6F5D6","#32CD32"]).interpolate(d3.interpolateRgb),k=d3.scale.linear().domain(d3.extent(e,function(t){return parseFloat(t[B])})).range(["#F8D0D8","#DC143C"]).interpolate(d3.interpolateRgb)}function s(t,e,i){t.scale(e),I.select("#"+i).transition().duration(1500).call(t)}function o(){J.transition().duration(1500).attr({cx:function(t){return C(t[W])},cy:function(t){return N(t[q])},fill:function(t){return"Sans"===t.Grazie?A(parseFloat(t[B])):k(parseFloat(t[B]))}})}function c(t,e){I.select("#circles").selectAll("."+t.replace(/\s/g,"-")).transition().duration(e).attr({stroke:"black","stroke-width":1,opacity:1,r:6})}function d(t,e){I.select("#circles").select("#"+v.replace(/\s/g,"-")+"_"+t.replace(/\s/g,"-")).transition().duration(e).attr({stroke:"black","stroke-width":2,opacity:1,r:10})}function p(){J.attr({stroke:"black","stroke-width":0,r:4,opacity:.5})}function u(t){P.selectAll(".availableFontWeight").remove(),"---"!==t&&P.select("#fontWeight ul").selectAll("li .availableFontWeight").data(G[t]).enter().append("li").attr("class","availableFontWeight").style({cursor:"pointer",role:"menuitem",tabindex:-1}).text(function(t){return t.StyleName})}function g(t,e,i){t.each(function(){for(var t,n=d3.select(this),a=n.text().split(/;/).reverse(),r=[],l=0,s=1.1,o=n.attr("y"),c=n.attr("dy")?n.attr("dy"):0,d=n.text(null).append("tspan").attr("x",i).attr("y",o).attr("dy",c+"em");t=a.pop();)r.push(t),d.text(r.join(" ")),d.node().getComputedTextLength()>e&&(r.pop(),d.text(r.join(" ")),r=[t],d=n.append("tspan").attr("x",i).attr("y",o).attr("dy",++l*s+c+"em").text(t))})}function m(t){return t.filter(function(t){return"Mono"===t.Spacing})}function h(t){return t.filter(function(t){return t.StyleName.match(/Regular/g)||t.StyleName.match(/Book/g)||t.StyleName.match(/Roman/g)||t.StyleName.match(/Normal/g)||t.StyleName.match(/^Text$/g)||t.StyleName.match(/^Condensed$/)||t.StyleName.match(/^Condensed Display$/)||t.StyleName.match(/^Condensed Caption$/)||t.StyleName.match(/^Condensed Subhead$/)||t.StyleName.match(/^Semicondensed$/)||t.StyleName.match(/^Extended$/)||t.StyleName.match(/^Semiextended$/)||t.StyleName.match(/^Caption$/)||t.StyleName.match(/^Display$/g)||t.StyleName.match(/^Subhead$/g)||t.StyleName.match(/Compact/g)||t.StyleName.match(/Sub-caption/g)||t.StyleName.match(/Mittelschrift/g)||t.StyleName.match(/Address/g)||t.StyleName.match(/Name/g)||t.StyleName.match(/Medium/g)})}function f(t){return t.filter(function(t){return t.StyleName.match(/Light/g)||t.StyleName.match(/Ultralight/g)||t.StyleName.match(/Semilight/g)||t.StyleName.match(/Thin/g)||t.StyleName.match(/Hairline/g)||t.StyleName.match(/Extralight/g)})}function y(t){return t.filter(function(t){return t.StyleName.match(/Bold/g)||t.StyleName.match(/Demi/g)||t.StyleName.match(/Semibold/g)})}function x(t){return t.filter(function(t){return t.StyleName.match(/Black/g)||t.StyleName.match(/Heavy/g)||t.StyleName.match(/Super/g)||t.StyleName.match(/^Ultra$/g)||t.StyleName.match(/Ultrabold/g)||t.StyleName.match(/Nord/g)||t.StyleName.match(/Extra Bold/g)||t.StyleName.match(/Extrabold/g)})}var S,v,b,A,k,C,N,D,w,F,E,R=d3.keys(e[0]).filter(function(t){return"FamilyName"!==t&&"Spacing"!==t&&"StyleName"!==t&&"Grazie"!==t&&"Bezier"!==t&&"SimmetriaAggettiT"!==t&&"AltezzaMassimaH"!==t&&"PuntoMedioAstaOrizzontaleH"!==t&&"PuntoMedioAstaVerticaleT"!==t&&"AggettoSinistroT"!==t&&"AggettoDestroT"!==t&&"SimmetriaAggettiT"!==t}),H=e.filter(function(t){return"Sans"===t.Grazie}),z=e.filter(function(t){return"Serif"===t.Grazie}),O=855,T=860,M=50,W="xHeight",q="xHeight",B="xHeight",L=_.sortBy(_.uniq(e,"FamilyName"),"FamilyName"),G=_.groupBy(e,"FamilyName"),I=d3.select("#svg-scatterplot-container").append("svg").attr("viewBox","0 0 "+O+" "+T).attr("preserveAspectRatio","xMaxYMin").attr("meetOrSlice","meet"),P=(I.append("clipPath").attr("id","scatterplot-area").append("rect").attr("x",M).attr("y",M).attr("width",O-2*M).attr("height",T-2*M),d3.select("#svg-scatterplot-legend"));P.select("#fontFamily ul").append("li").style({cursor:"pointer",role:"menuitem",tabindex:-1}).text("---"),P.select("#fontWeight ul").append("li").style({cursor:"pointer",role:"menuitem",tabindex:-1}).text("---"),P.select("#fontFamily ul").selectAll("li .availableFontFamily").filter(function(){return".deselect"!==this["class"]}).data(L).enter().append("li").attr("class","availableFontFamily").style({cursor:"pointer",role:"menuitem",tabindex:-1}).text(function(t){return t.FamilyName}),d3.select("#xAxisScatterplot ul").selectAll("li").data(R).enter().append("li").style({cursor:"pointer",role:"menuitem",tabindex:-1}).text(function(t){return t}),d3.select("#yAxisScatterplot ul").selectAll("li").data(R).enter().append("li").style({cursor:"pointer",role:"menuitem",tabindex:-1}).text(function(t){return t}),d3.select("#circleColor ul").selectAll("li").data(R).enter().append("li").style({cursor:"pointer",role:"menuitem",tabindex:-1}).text(function(t){return t}),a(W),r(q),l(B);var U=I.append("line").attr("id","linRegTot").style("stroke","#353531"),j=I.append("line").attr("id","linRegSans").style("stroke","#32CD32"),V=I.append("line").attr("id","linRegSerif").style("stroke","#DC143C"),Y=I.append("line").attr("id","tempLine");i(W,q,e,U,1500),i(W,q,H,j,1500),i(W,q,z,V,1500);var J=I.append("g").attr("id","circles").attr("clip-path","url(#scatterplot-area)").selectAll("circle").data(e).enter().append("circle").attr({"class":function(t){return t.FamilyName.replace(/\s/g,"-")},id:function(t){return t.FamilyName.replace(/\s/g,"-")+"_"+t.StyleName.replace(/\s/g,"-")}}).on("mouseover",function(t){I.selectAll("circle").attr("opacity",.25),d3.select(this).transition().duration(500).attr({r:10,opacity:1});var e=d3.select(this).attr("cx"),i=parseFloat(d3.select(this).attr("cy"));I.append("text").attr({"class":"circleTooltip",x:e,y:i-T/15,"pointer-events":"none","text-anchor":O/2>e?"start":"end"}).text("Family: "+t.FamilyName+";Style: "+t.StyleName+";"+W+": "+t[W]+", "+q+": "+t[q]).call(g,50,e)}).on("mouseout",function(){I.selectAll(".circleTooltip").remove(),p(),c(v,0),d(b,0)});o(),p(),D=d3.svg.axis().scale(C).ticks(20).orient("bottom"),w=d3.svg.axis().scale(N).ticks(20).orient("left"),I.append("g").attr("class","axis").attr("id","xaxis").attr("transform","translate(0,"+(T-M)+")").call(D),I.append("g").attr("class","axis").attr("id","yaxis").attr("transform","translate("+M+", 0)").call(w),$("#fontFamily").on("click",".dropdown-menu li",function(){v=$(this).text(),$("#fontFamilyDropdown").html(v+' <i class="fa fa-caret-down"></i>'),$("#fontFamilyDropdown").val(v),p(),"---"!==v?(c(v,500),u(v),S=e.filter(function(t){return t.FamilyName==v}),i(W,q,S,Y,0)):"---"===v&&($("#fontWeightDropdown").html('--- <i class="fa fa-caret-down"></i>'),$("#fontWeightDropdown").val("---"),p(),u(v),S=[0,0],i(W,q,S,Y,0))}),$("#fontWeight").on("click",".dropdown-menu li",function(){b=$(this).text(),$("#fontWeightDropdown").html(b+' <i class="fa fa-caret-down"></i>'),$("#fontWeightDropdown").val(b),"---"!==b?(c(v,500),d(b,500)):c(v)}),d3.select("#xAxisScatterplot a").attr("data-content",n("select")),d3.select("#yAxisScatterplot a").attr("data-content",n("select")),d3.select("#circleColor a").attr("data-content",n("select")),$("#xAxisScatterplot").on("click",".dropdown-menu li",function(){W=$(this).text(),$("#xAxisScatterplotDropdown").html(W+' <i class="fa fa-caret-down"></i>'),$("#xAxisScatterplotDropdown").val(W);var t=$("#xAxisScatterplotDropdown").val();d3.select("#xAxisScatterplot a").attr("data-content",n(t)),a(W),o(),s(D,C,"xaxis"),i(W,q,e,U,1500),i(W,q,H,j,1500),i(W,q,z,V,1500),i(W,q,S,Y,1500)}),$("#yAxisScatterplot").on("click",".dropdown-menu li",function(){q=$(this).text(),$("#yAxisScatterplotDropdown").html(q+' <i class="fa fa-caret-down"></i>'),$("#yAxisScatterplotDropdown").val(q);var t=$("#yAxisScatterplotDropdown").val();d3.select("#yAxisScatterplot a").attr("data-content",n(t)),r(q),o(),s(w,N,"yaxis"),i(W,q,e,U,1500),i(W,q,H,j,1500),i(W,q,z,V,1500),i(W,q,S,Y,1500)}),$("#circleColor").on("click",".dropdown-menu li",function(){B=$(this).text(),$("#circleColorDropdown").html(B+' <i class="fa fa-caret-down"></i>'),$("#circleColorDropdown").val(B);var t=$("#circleColorDropdown").val();d3.select("#circleColor a").attr("data-content",n(t)),l(B),o(),$("#SelColLegend").text(B)});var K=J.filter(function(t){return"Sans"===t.Grazie}),Q=J.filter(function(t){return"Serif"===t.Grazie}),X=m(K),Z=m(Q),te=h(K),ee=h(Q),ie=f(K),ne=f(Q),ae=y(K),re=y(Q),le=x(K),se=x(Q);d3.select("#SansMonoCheckbox").on("change",function(){this.checked===!0?X.style("visibility","visible"):X.style("visibility","hidden")}),d3.select("#SerifMonoCheckbox").on("change",function(){this.checked===!0?Z.style("visibility","visible"):Z.style("visibility","hidden")}),d3.select("#SansLightCheckbox").on("change",function(){this.checked===!0?ie.style("visibility","visible"):ie.style("visibility","hidden")}),d3.select("#SerifLightCheckbox").on("change",function(){this.checked===!0?ne.style("visibility","visible"):ne.style("visibility","hidden")}),d3.select("#SansRegularCheckbox").on("change",function(){this.checked===!0?te.style("visibility","visible"):te.style("visibility","hidden")}),d3.select("#SerifRegularCheckbox").on("change",function(){this.checked===!0?ee.style("visibility","visible"):ee.style("visibility","hidden")}),d3.select("#SansBoldCheckbox").on("change",function(){this.checked===!0?ae.style("visibility","visible"):ae.style("visibility","hidden")}),d3.select("#SerifBoldCheckbox").on("change",function(){this.checked===!0?re.style("visibility","visible"):re.style("visibility","hidden")}),d3.select("#SansUltraCheckbox").on("change",function(){this.checked===!0?le.style("visibility","visible"):le.style("visibility","hidden")}),d3.select("#SerifUltraCheckbox").on("change",function(){this.checked===!0?se.style("visibility","visible"):se.style("visibility","hidden")})});
